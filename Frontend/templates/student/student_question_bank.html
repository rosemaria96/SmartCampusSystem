{% extends 'base.html' %}
{% load static %}

{% block title %}Question Bank | Cruz Horizon{% endblock %}
{% block portal_name %}Student Portal{% endblock %}

{% block sidebar %}
{% include 'partials/sidebar_student.html' %}
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="d-flex justify-content-between align-items-end mb-4">
    <div>
        <h2 class="fw-bold mb-1">Question Bank</h2>
        <p class="text-white-50">Access previous year question papers</p>
    </div>
</div>

<!-- Filter Section -->
<div class="content-card mb-4">
    <form method="GET" class="row g-3 align-items-end">
        <div class="col-md-3">
            <label class="form-label small text-muted">Course</label>
            <select name="course" class="form-select form-select-sm" onchange="this.form.submit()">
                <option value="">All Courses</option>
                {% for c in courses %}
                <option value="{{ c.id }}" {% if selected_course == c.id %}selected{% endif %}>{{ c.course_name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label small text-muted">Semester</label>
            <select name="semester" class="form-select form-select-sm" onchange="this.form.submit()">
                <option value="">All Semesters</option>
                {% for s in semesters %}
                <option value="{{ s.id }}" {% if selected_semester == s.id %}selected{% endif %}>
                    {% if s.course %}
                    {{ s.course.course_name }} - Sem {{ s.semester_number }}
                    {% else %}
                    Semester {{ s.semester_number }}
                    {% endif %}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label small text-muted">Subject</label>
            <select name="subject" class="form-select form-select-sm" onchange="this.form.submit()">
                <option value="">All Subjects</option>
                {% for sub in subjects %}
                <option value="{{ sub.id }}" {% if selected_subject == sub.id %}selected{% endif %}>{{ sub.subject_name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <a href="{% url 'student_question_bank' %}" class="btn btn-sm btn-outline-dark">Reset Filters</a>
        </div>
    </form>
</div>

<!-- Available Papers Table -->
<div class="content-card">
    <h5 class="fw-bold mb-4">Available Question Papers</h5>
    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead>
                <tr class="text-muted small text-uppercase">
                    <th class="ps-3">Subject</th>
                    <th>Course & Semester</th>
                    <th>Year</th>
                    <th>Uploaded By</th>
                    <th class="text-end">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for paper in question_papers %}
                <tr>
                    <td class="fw-bold ps-3">{{ paper.subject.subject_name }}</td>
                    <td class="text-muted small">
                        {{ paper.subject.semester.course.course_name }} (Sem {{ paper.subject.semester.semester_number }})
                    </td>
                    <td>{{ paper.exam_year }}</td>
                    <td class="text-muted small">{{ paper.uploaded_by.name }}</td>
                    <td class="text-end">
                        {% if paper.pdf_path %}
                        <a href="{{ paper.pdf_path.url }}" class="btn btn-sm btn-outline-secondary" download><i
                                class="bi bi-download"></i></a>
                        {% else %}
                        <button class="btn btn-sm btn-outline-secondary" disabled><i
                                class="bi bi-download"></i></button>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center text-muted py-4">No question papers available.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
