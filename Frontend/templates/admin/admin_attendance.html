{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Attendance | Cruz Horizon{% endblock %}
{% block portal_name %}Admin Portal{% endblock %}

{% block extra_head %}
<style>
    .stat-card.admin-stat {
        background: #fff;
        padding: 24px;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
    }

    body:not(.light-mode) .stat-card.admin-stat {
        background: #111827;
        border-color: #1f2937;
    }

    .stat-label {
        color: #64748b;
        font-size: 0.875rem;
        margin-bottom: 8px;
    }

    body:not(.light-mode) .stat-label {
        color: #94a3b8;
    }

    .stat-value {
        font-size: 1.875rem;
        font-weight: 700;
        line-height: 1;
    }
</style>
{% endblock %}

{% block sidebar %}
{% include 'partials/sidebar_admin.html' %}
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="d-flex justify-content-between align-items-end mb-4 flex-wrap gap-3">
    <div>
        <h2 class="fw-bold mb-1">Attendance Management</h2>
        <p class="text-white-50">Monitor and manage attendance across all classes</p>
    </div>
    <div>
        <button class="btn btn-black"><i class="bi bi-download me-2"></i>Export Report</button>
    </div>
</div>

<!-- Summary Stats -->
<div class="row g-3 mb-4">
    <div class="col-6 col-md-3">
        <div class="stat-card admin-stat">
            <div class="stat-label">Overall Rate</div>
            <div class="stat-value text-primary">{{ overall_rate }}%</div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="stat-card admin-stat">
            <div class="stat-label">Today's Rate</div>
            <div class="stat-value text-success">{{ today_rate }}%</div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="stat-card admin-stat">
            <div class="stat-label">Absent Today</div>
            <div class="stat-value text-danger">{{ absent_today }}</div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="stat-card admin-stat">
            <div class="stat-label">Total Students</div>
            <div class="stat-value text-purple" style="color: #a855f7;">{{ total_students }}</div>
        </div>
    </div>
</div>

<!-- Class-wise Attendance Table -->
<div class="content-card">
    <h6 class="fw-bold mb-4">Class-wise Attendance</h6>

    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th>Course</th>
                    <th>Semester</th>
                    <th>Total Students</th>
                    <th>Present Records</th>
                    <th>Total Records</th>
                    <th>Percentage</th>
                </tr>
            </thead>
            <tbody>
                {% for item in class_attendance_data %}
                <tr>
                    <td class="fw-bold">{{ item.course_name }}</td>
                    <td>Semester {{ item.semester.semester_number }}</td>
                    <td>{{ item.student_count }}</td>
                    <td>{{ item.present_records }}</td>
                    <td>{{ item.total_records }}</td>
                    <td>
                        {% if item.percentage >= 75 %}
                        <span class="badge bg-success text-white px-3 py-2 rounded-pill">{{ item.percentage }}%</span>
                        {% elif item.percentage >= 60 %}
                        <span class="badge bg-warning text-dark px-3 py-2 rounded-pill">{{ item.percentage }}%</span>
                        {% else %}
                        <span class="badge bg-danger text-white px-3 py-2 rounded-pill">{{ item.percentage }}%</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-4 text-muted">No attendance data found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}